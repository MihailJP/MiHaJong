/*=============================
 * HSPñÉêùÉNÉâÉCÉAÉìÉgMiHaJong
 *     [îvïàãLò^ÉãÅ[É`Éì]
 *=============================
 */

#module
#include "const.as"
#deffunc haifuskip array haifuP, array HThaifuP, int PassivePlayer, int ActivePlayer
	if (playerRelative(ActivePlayer, PassivePlayer) == RELATIVE_TOIMEN) {
		// ëŒñ Ç©ÇÁÉ|ÉìÇµÇΩèÍçá
		repeat 4,1
			haifuP(ShimochaOf(ActivePlayer)*6+cnt) += "Å@ "
			HThaifuP(ShimochaOf(ActivePlayer)*6+cnt) += "<td></td>"
		loop
	}
	if (playerRelative(ActivePlayer, PassivePlayer) == RELATIVE_KAMICHA) {
		// â∫â∆Ç©ÇÁÉ|ÉìÇµÇΩèÍçá
		repeat 4,1
			haifuP(ShimochaOf(ActivePlayer)*6+cnt) += "Å@ "
			haifuP(ToimenOf(ActivePlayer)*6+cnt) += "Å@ "
			HThaifuP(ShimochaOf(ActivePlayer)*6+cnt) += "<td></td>"
			HThaifuP(ToimenOf(ActivePlayer)*6+cnt) += "<td></td>"
		loop
	}
return
#global

#module
#include "const.as"
#defcfunc haifudoraClass int Akadora
	switch Akadora
		case 1:
			return " class=\"akadora\"": swbreak
		case 2:
			return " class=\"aodora\"": swbreak
		default:
			return "": swbreak
	swend
return ""
#global

#module
#include "const.as"
#deffunc haifuwritetsumohai array haifuP, array HThaifuP, int ActivePlayer, int Tile, int Akadora, str PText, str HTText
	haifuP(ActivePlayer*6+1) += strmid(tilecodelabel@haifu, (Tile+Akadora*TILE_NONFLOWER_MAX)*2, 2)+" "
	haifuP(ActivePlayer*6+2) += PText
	HThaifuP(ActivePlayer*6+1) += "<td"+haifudoraClass(Akadora)+">"
	HThaifuP(ActivePlayer*6+1) += ""+strmid(HTtilecodelabel1@haifu, (Tile+Akadora*TILE_NONFLOWER_MAX), 1)+"</td>"
	HThaifuP(ActivePlayer*6+2) += "<td>"+HTText+"</td>"
return
#global

#module
#include "const.as"
#deffunc haifuskipall array haifuP, array HThaifuP, int PassivePlayer
	repeat 4,1
		haifuP(ShimochaOf(PassivePlayer)*6+cnt) += "Å@ "
		haifuP(ToimenOf(PassivePlayer)*6+cnt) += "Å@ "
		haifuP(KamichaOf(PassivePlayer)*6+cnt) += "Å@ "
		HThaifuP(ShimochaOf(PassivePlayer)*6+cnt) += "<td></td>"
		HThaifuP(ToimenOf(PassivePlayer)*6+cnt) += "<td></td>"
		HThaifuP(KamichaOf(PassivePlayer)*6+cnt) += "<td></td>"
	loop
return
#global

#module haifu
#include "const.as"

#define COLUMNS 40

/* àÍîºëëï™ÇÃîvïàÉoÉbÉtÉ@Çèâä˙âª */
#deffunc haifubufinit

	/* êùîvÇÃñºëOÉfÅ[É^ */
	tilecodelabel = "ÅHàÍìÒéOélå‹òZéµî™ã„ÅHá@áAáBáCáDáEáFáGáHÅHÇPÇQÇRÇSÇTÇUÇVÇWÇXÅHìåìÏêºñkîí·¢íÜÅHÅHÅHàÎìÛéQ„Êåﬁó§éΩéJãËÅHáJáKáLáMáNáOáPáQáRÅHáTáUáVáWáXáYáZá[á\ÅHÇdÇrÇvÇmÇoÇeÇbÅHÅHÅH1]2]3]4]5]6]7]8]9]ÅH1)2)3)4)5)6)7)8)9)ÅH1}2}3}4}5}6}7}8}9}ÅHE>S>W>N>P>F>C>ÅHÅHÅHètâƒèHì~ïSî~óñãeí|ÅH"
	HTtilecodelabel1 = " qwertyuio zxcvbnm,. asdfghjkl 1234567   qwertyuio zxcvbnm,. asdfghjkl 1234567   qwertyuio zxcvbnm,. asdfghjkl 1234567   -^\\[5@;:]"
	HTtilecodelabel2 = " QWERTYUIO ZXCVBNM<> ASDFGHJKL !\"#$%&'   QWERTYUIO ZXCVBNM<> ASDFGHJKL !\"#$%&'   QWERTYUIO ZXCVBNM<> ASDFGHJKL !\"#$%&'   -^\\[%@;:]"

	dim origPoint, NUM_OF_PLAYERS, NUM_OF_DIGIT_GROUPS
	sdim haifuBuffer, 512*1024
	notesel haifuBuffer
#ifdef SANMAS
	tmptxt = "MiHaJong êîîvéOñÉîvïàÉfÅ[É^ Ver. "+VERSION_MAJ+"."+VERSION_MED+"."+VERSION_MIN+VERSION_MIC
#else
#ifdef SANMA4
	tmptxt = "MiHaJong élêléOñÉîvïàÉfÅ[É^ Ver. "+VERSION_MAJ+"."+VERSION_MED+"."+VERSION_MIN+VERSION_MIC
#else
#ifdef SANMA
	tmptxt = "MiHaJong éOêlë≈ÇøîvïàÉfÅ[É^ Ver. "+VERSION_MAJ+"."+VERSION_MED+"."+VERSION_MIN+VERSION_MIC
#else
	tmptxt = "MiHaJong élêlë≈ÇøîvïàÉfÅ[É^ Ver. "+VERSION_MAJ+"."+VERSION_MED+"."+VERSION_MIN+VERSION_MIC
#endif
#endif
#endif
	noteadd tmptxt
	noteadd ""
	noteadd "------------------------------------------------------------------------------"
	noteadd ""
	noteunsel
	sdim HThaifuBuffer, 512*1024
	notesel HThaifuBuffer
	noteadd "<html>"
	noteadd "<head>"
	noteadd "<title>"+tmptxt+"</title>"
	noteadd "<meta http-equiv=\"Content-Type\" content=\"text/html; charset=Shift_JIS\">"
	noteadd "<link rel=\"stylesheet\" href=\"haifu.css\" type=\"text/css\">"
	noteadd "</head>"
	noteadd "<body>"
	noteadd "<h1>"+tmptxt+"</h1>"
	noteadd "<hr>"
	noteunsel
return

/* àÍã«ï™ÇÃîvïàÉoÉbÉtÉ@Çèâä˙âª */
#deffunc haifuinit
	sdim haifuP, 1024, 24
	haifuDora = ""
	haifuUraDora = ""
	haifuAliceDora = ""
	haifuAliceDoraMax = ""
	haifuResultDesc = ""
	sdim HThaifuP, 1024, 24
	HThaifuDora = ""
	HThaifuUraDora = ""
	HThaifuAliceDora = ""
	HThaifuAliceDoraMax = ""
	HThaifuResultDesc = ""
return

/* îzîvÇîvïàÇ…ãLò^ */
#deffunc haifurechaipai var GameStat
	repeat NUM_OF_PLAYERS
		tmpcnt = cnt
		repeat NUM_OF_TILES_IN_HAND
			if (getHand(GameStat, HAND_TILECODE, cnt, tmpcnt) > 0) {
				haifuP(tmpcnt*6) += strmid(tilecodelabel, (getHand(GameStat, HAND_TILECODE, cnt, tmpcnt)+(getHand(GameStat, HAND_REDTILE, cnt, tmpcnt)*TILE_NONFLOWER_MAX))*2, 2)
				if (getHand(GameStat, HAND_REDTILE, cnt, tmpcnt)) {HThaifuP(tmpcnt*6) += "<span"+haifudoraClass(getHand(GameStat, HAND_REDTILE, cnt, tmpcnt))+">"}
				HThaifuP(tmpcnt*6) += strmid(HTtilecodelabel1, (getHand(GameStat, HAND_TILECODE, cnt, tmpcnt)+(getHand(GameStat, HAND_REDTILE, cnt, tmpcnt)*TILE_NONFLOWER_MAX)), 1)
				if (getHand(GameStat, HAND_REDTILE, cnt, tmpcnt)) {HThaifuP(tmpcnt*6) += "</span>"}
			}
		loop
		repeat NUM_OF_DIGIT_GROUPS
			origPoint(tmpcnt, cnt) == getScore(GameStat,tmpcnt, cnt)
		loop
	loop
return

/* ÉhÉâÇîvïàÇ…ãLò^ */
#deffunc haifurecdora int tmpDora
	haifuDora += strmid(tilecodelabel, tmpDora*2, 2)
	HThaifuDora += strmid(HTtilecodelabel1, tmpDora, 1)
return

/* ó†ÉhÉâÇîvïàÇ…ãLò^ */
#deffunc haifurecuradora int tmpDora
	haifuUraDora += strmid(tilecodelabel, tmpDora*2, 2)
	HThaifuUraDora += strmid(HTtilecodelabel1, tmpDora, 1)
return

/* ÉAÉäÉXÉhÉâÇîvïàÇ…ãLò^ */
#deffunc haifurecalicedora int tmpDora
	haifuAliceDora += strmid(tilecodelabel, tmpDora*2, 2)
	HThaifuAliceDora += strmid(HTtilecodelabel1, tmpDora, 1)
return

/* ÉAÉäÉXÉhÉâÇçXêV */
#deffunc haifualicedoraupd
	if (strlen(haifuAliceDora) > strlen(haifuAliceDoraMax)) {
		haifuAliceDoraMax = haifuAliceDora
		HThaifuAliceDoraMax = HThaifuAliceDora
	}
return

/* ÉAÉäÉXÉhÉâèâä˙âª */
#deffunc haifuresetalicedora
	haifuAliceDora = ""
	HThaifuAliceDora = ""
return

/* ÉhÉâÇÃÉZÉpÉåÅ[É^Å[ */
#deffunc haifurecdorap
	haifuDora += " "
	haifuUraDora += " "
	haifuAliceDora += " "
	HThaifuDora += "</span> <span class=\"tile\">"
	HThaifuUraDora += "</span> <span class=\"tile\">"
	HThaifuAliceDora += "</span> <span class=\"tile\">"
return

/* ñÃë≈ÇîvïàÇ…ãLò^ */
#deffunc haifurecmota var GameStat, int DiscardTileIndex
	// ÉcÉÇÇ¡ÇƒÇ´ÇΩîvÇãLò^
	if (getHeavenHandFlag(GameStat) == 1) {
		// êeÇÃÇPèÑñ⁄
		haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+1) += "Å@ "
		haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+2) += "Å@ "
		HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+1) += "<td></td>"
		HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+2) += "<td></td>"
	} else {
		if (getHand(GameStat, HAND_TILECODE, TSUMOHAI_INDEX, getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)) == 0) {
			// ñ¬Ç¢ÇΩíºå„
			haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+1) += ""
			haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+2) += ""
			HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+1) += ""
			HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+2) += ""
		} else {
			if ((DiscardTileIndex\DAHAI_TYPE_STEP) == TSUMOHAI_INDEX) {
				// ÉcÉÇêÿÇË
				haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+1) += "Å´ "
				haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+2) += "Å@ "
				HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+1) += "<td class=\"fallthru\">Å´</td>"
				HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+2) += "<td></td>"
			} else {
				// éËèoÇµ(ãÛèoÇµÇÃèÍçáÇ‡ä‹Çﬁ)
				haifuwritetsumohai haifuP, HThaifuP, getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE), getHand(GameStat, HAND_TILECODE, TSUMOHAI_INDEX, getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)), getHand(GameStat, HAND_REDTILE, TSUMOHAI_INDEX, getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)), "Å@ ", ""
			}
		}
	}
	// éÃÇƒÇΩîvÇãLò^
	haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+3) += strmid(tilecodelabel, (getHand(GameStat, HAND_TILECODE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))+(getHand(GameStat, HAND_REDTILE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))*TILE_NONFLOWER_MAX))*2, 2)+" "
	HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+3) += "<td"+haifudoraClass(getHand(GameStat, HAND_REDTILE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)))+">"
	HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+3) += ""+strmid(HTtilecodelabel1, (getHand(GameStat, HAND_TILECODE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))+(getHand(GameStat, HAND_REDTILE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))*TILE_NONFLOWER_MAX)), 1)+"</td>"
return

/* ï˙èeÇµÇΩÇ©î€Ç©ÇîvïàÇ…ãLò^ */
#deffunc haifurecfurikomi var GameStat
	if ((getRichiFlag(GameStat, RICHI_FLAG, getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)) == RIICHI_IPPATSU)||(getRichiFlag(GameStat, RICHI_FLAG, getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)) == RIICHI_DOUBLE_IPPATSU)) {
		// óßíºêÈåæîvÇÃèÍçá
		if (RonPlayers(GameStat) > 0) {
			// óßíºêÈåæîvÇ≈ÇÃêUÇËçûÇ›
			haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+4) += "ÿX "
			HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+4) += "<td>ÉäÅ[É`<br>ÉEÉ`</td>"
		} else {
			// óßíºÇ™í Ç¡ÇΩèÍçá
			haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+4) += "ÿ∞¡"
			HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+4) += "<td>ÉäÅ[É`</td>"
		}
	} else {
		// ÇªÇÍà»äOÇÃèÍçá
		if (RonPlayers(GameStat) > 0) {
			// í èÌÇÃêUÇËçûÇ›
			haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+4) += "≥¡ "
			HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+4) += "<td>ÉEÉ`</td>"
		} else {
			// âΩÇ‡Ç»Ç©Ç¡ÇΩèÍçá
			haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+4) += "Å@ "
			HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+4) += "<td></td>"
		}
	}
return

/* É`Å[ÇµÇΩÇ±Ç∆ÇîvïàÇ…ãLò^ */
#deffunc haifurecchi var GameStat, int PassivePlayer
	haifuwritetsumohai haifuP, HThaifuP, PassivePlayer, getCurrentDiscard(GameStat, CURRENTDISCARD_TILECODE), getCurrentDiscard(GameStat, CURRENTDISCARD_REDTILE), "¡∞ ", "É`Å["
return

/* É|ÉìÇµÇΩÇ±Ç∆ÇîvïàÇ…ãLò^ */
#deffunc haifurecpon var GameStat, int PassivePlayer
	haifuskip haifuP, HThaifuP, PassivePlayer, getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)
	haifuwritetsumohai haifuP, HThaifuP, PassivePlayer, getCurrentDiscard(GameStat, CURRENTDISCARD_TILECODE), getCurrentDiscard(GameStat, CURRENTDISCARD_REDTILE), "Œﬂ›", "É|Éì"
return

/* é©ñÃòaÇµÇΩÇ±Ç∆ÇîvïàÇ…ãLò^ */
#deffunc haifurectsumo var GameStat
	haifuwritetsumohai haifuP, HThaifuP, getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE), getHand(GameStat, HAND_TILECODE, TSUMOHAI_INDEX, getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)), getHand(GameStat, HAND_REDTILE, TSUMOHAI_INDEX, getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)), "¬” ", "ÉcÉÇ"
return

/* ëÂñæû»ÇµÇΩÇ±Ç∆ÇîvïàÇ…ãLò^ */
#deffunc haifurecminkan var GameStat, int PassivePlayer
	haifuskip haifuP, HThaifuP, PassivePlayer, getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)
	haifuwritetsumohai haifuP, HThaifuP, PassivePlayer, getCurrentDiscard(GameStat, CURRENTDISCARD_TILECODE), getCurrentDiscard(GameStat, CURRENTDISCARD_REDTILE), "∂› ", "ÉJÉì"
	haifuP(PassivePlayer*6+3) += "Å@ "
	haifuP(PassivePlayer*6+4) += "Å@ "
	HThaifuP(PassivePlayer*6+3) += "<td></td>"
	HThaifuP(PassivePlayer*6+4) += "<td></td>"
	// îvïàÇÃãLèqè„ÇÕÅAó‰è„îvÇÃéÊìæÇÕéüèÑÇ∆ÇµÇƒàµÇ§
	haifuskipall haifuP, HThaifuP, PassivePlayer
return

#ifdef SANMAX
/* î≤Ç´ñkÇîvïàÇ…ãLò^ */
#deffunc haifurecnorth var GameStat, int DiscardTileIndex
	if ((getHeavenHandFlag(GameStat) == 1)||((DiscardTileIndex\DAHAI_TYPE_STEP) != TSUMOHAI_INDEX)) {
		// êeÇÃÇPèÑñ⁄ÇÃèÍçáÇ©ÅAÉcÉÇÇ¡ÇƒÇ´ÇΩîvà»äOÇÉJÉìÇµÇΩèÍçá
		if (getHeavenHandFlag(GameStat) == 1) {
			haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+1) += "Å@ "
			haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+2) += "Å@ "
			haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+3) += strmid(tilecodelabel, (getHand(GameStat, HAND_TILECODE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))+(getHand(GameStat, HAND_REDTILE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))*TILE_NONFLOWER_MAX))*2, 2)+" "
			HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+1) += "<td></td>"
			HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+2) += "<td></td>"
			HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+3) += "<td"+haifudoraClass(getHand(GameStat, HAND_REDTILE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)))+">"
			HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+3) += ""+strmid(HTtilecodelabel1, (getHand(GameStat, HAND_TILECODE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))+(getHand(GameStat, HAND_REDTILE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))*TILE_NONFLOWER_MAX)), 1)+"</td>"
			haifukanflag = 1
		} else {
			if (getHand(GameStat, HAND_TILECODE, TSUMOHAI_INDEX, getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)) == getHand(GameStat, HAND_TILECODE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))) {
				haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+1) += strmid(tilecodelabel, (getHand(GameStat, HAND_TILECODE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))+(getHand(GameStat, HAND_REDTILE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))*TILE_NONFLOWER_MAX))*2, 2)+" "
				HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+1) += "<td"+haifudoraClass(getHand(GameStat, HAND_REDTILE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)))+">"
				HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+1) += ""+strmid(HTtilecodelabel1, (getHand(GameStat, HAND_TILECODE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))+(getHand(GameStat, HAND_REDTILE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))*TILE_NONFLOWER_MAX)), 1)+"</td>"
				haifukanflag = 0
			} else {
				haifuwritetsumohai haifuP, HThaifuP, getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE), getHand(GameStat, HAND_TILECODE, TSUMOHAI_INDEX, getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)), getHand(GameStat, HAND_REDTILE, TSUMOHAI_INDEX, getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)), "Å@ ", ""
				haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+3) += strmid(tilecodelabel, (getHand(GameStat, HAND_TILECODE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))+(getHand(GameStat, HAND_REDTILE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))*TILE_NONFLOWER_MAX))*2, 2)+" "
				HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+3) += "<td"+haifudoraClass(getHand(GameStat, HAND_REDTILE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)))+">"
				HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+3) += ""+strmid(HTtilecodelabel1, (getHand(GameStat, HAND_TILECODE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))+(getHand(GameStat, HAND_REDTILE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))*TILE_NONFLOWER_MAX)), 1)+"</td>"
				haifukanflag = 1
			}
		}
	} else {
		haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+1) += strmid(tilecodelabel, (getHand(GameStat, HAND_TILECODE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))+(getHand(GameStat, HAND_REDTILE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))*TILE_NONFLOWER_MAX))*2, 2)+" "
		HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+1) += "<td"+haifudoraClass(getHand(GameStat, HAND_REDTILE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)))+">"
		HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+1) += ""+strmid(HTtilecodelabel1, (getHand(GameStat, HAND_TILECODE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))+(getHand(GameStat, HAND_REDTILE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))*TILE_NONFLOWER_MAX)), 1)+"</td>"
		haifukanflag = 0
	}
return

/* ùèÅgñkÅhÇîvïàÇ…ãLò^ */
#deffunc haifurecchanpei var GameStat
	if (haifukanflag == 1) {
		// êeÇÃÇPèÑñ⁄ÇÃèÍçáÇ©ÅAÉcÉÇÇ¡ÇƒÇ´ÇΩîvà»äOÇÉJÉìÇµÇΩèÍçá
		haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+4) += "î≤X"
		HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+4) += "<td>î≤<br>ÉEÉ`</td>"
	} else {
		haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+2) += "î≤X"
		HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+2) += "<td>î≤<br>ÉEÉ`</td>"
	}
return

/* î≤Ç´ñkÇ™ê¨å˜ÇµÇΩèÍçáÇÃîvïàèàóù */
#deffunc haifurecnorthproc var GameStat
	if (haifukanflag == 1) {
		// êeÇÃÇPèÑñ⁄ÇÃèÍçáÇ©ÅAÉcÉÇÇ¡ÇƒÇ´ÇΩîvà»äOÇÉJÉìÇµÇΩèÍçá
		haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+4) += "î≤ "
		HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+4) += "<td>î≤</td>"
	} else {
		haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+2) += "î≤ "
		haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+3) += "Å@ "
		haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+4) += "Å@ "
		HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+2) += "<td>î≤</td>"
		HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+3) += "<td></td>"
		HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+4) += "<td></td>"
	}
	// îvïàÇÃãLèqè„ÇÕÅAó‰è„îvÇÃéÊìæÇÕéüèÑÇ∆ÇµÇƒàµÇ§
	haifuskipall haifuP, HThaifuP, getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)
return
#endif

/* à√û»Ç»Ç¢Çµâ¡û»ÇîvïàÇ…ãLò^ */
#deffunc haifurecankan var GameStat, int DiscardTileIndex
	if ((getHeavenHandFlag(GameStat) == 1)||((DiscardTileIndex\DAHAI_TYPE_STEP) != TSUMOHAI_INDEX)) {
		// êeÇÃÇPèÑñ⁄ÇÃèÍçáÇ©ÅAÉcÉÇÇ¡ÇƒÇ´ÇΩîvà»äOÇÉJÉìÇµÇΩèÍçá
		if (getHeavenHandFlag(GameStat) == 1) {
			haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+1) += "Å@ "
			haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+2) += "Å@ "
			haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+3) += strmid(tilecodelabel, (getHand(GameStat, HAND_TILECODE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))+(getHand(GameStat, HAND_REDTILE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))*TILE_NONFLOWER_MAX))*2, 2)+" "
			HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+1) += "<td></td>"
			HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+2) += "<td></td>"
			HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+3) += "<td"+haifudoraClass(getHand(GameStat, HAND_REDTILE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)))+">"
			HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+3) += ""+strmid(HTtilecodelabel1, (getHand(GameStat, HAND_TILECODE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))+(getHand(GameStat, HAND_REDTILE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))*TILE_NONFLOWER_MAX)), 1)+"</td>"
			haifukanflag = 1
		} else {
			if (getHand(GameStat, HAND_TILECODE, TSUMOHAI_INDEX, getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)) == getHand(GameStat, HAND_TILECODE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))) {
				haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+1) += strmid(tilecodelabel, (getHand(GameStat, HAND_TILECODE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))+(getHand(GameStat, HAND_REDTILE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))*TILE_NONFLOWER_MAX))*2, 2)+" "
				HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+1) += "<td"+haifudoraClass(getHand(GameStat, HAND_REDTILE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)))+">"
				HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+1) += ""+strmid(HTtilecodelabel1, (getHand(GameStat, HAND_TILECODE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))+(getHand(GameStat, HAND_REDTILE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))*TILE_NONFLOWER_MAX)), 1)+"</td>"
				haifukanflag = 0
			} else {
				haifuwritetsumohai haifuP, HThaifuP, getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE), getHand(GameStat, HAND_TILECODE, TSUMOHAI_INDEX, getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)), getHand(GameStat, HAND_REDTILE, TSUMOHAI_INDEX, getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)), "Å@ ", ""
				haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+3) += strmid(tilecodelabel, (getHand(GameStat, HAND_TILECODE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))+(getHand(GameStat, HAND_REDTILE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))*TILE_NONFLOWER_MAX))*2, 2)+" "
				HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+3) += "<td"+haifudoraClass(getHand(GameStat, HAND_REDTILE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)))+">"
				HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+3) += ""+strmid(HTtilecodelabel1, (getHand(GameStat, HAND_TILECODE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))+(getHand(GameStat, HAND_REDTILE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))*TILE_NONFLOWER_MAX)), 1)+"</td>"
				haifukanflag = 1
			}
		}
	} else {
		haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+1) += strmid(tilecodelabel, (getHand(GameStat, HAND_TILECODE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))+(getHand(GameStat, HAND_REDTILE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))*TILE_NONFLOWER_MAX))*2, 2)+" "
		HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+1) += "<td"+haifudoraClass(getHand(GameStat, HAND_REDTILE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)))+">"
		HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+1) += ""+strmid(HTtilecodelabel1, (getHand(GameStat, HAND_TILECODE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))+(getHand(GameStat, HAND_REDTILE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))*TILE_NONFLOWER_MAX)), 1)+"</td>"
		haifukanflag = 0
	}
return

/* ùèû»ÇîvïàÇ…ãLò^ */
#deffunc haifurecchankan var GameStat
	if (haifukanflag == 1) {
		// êeÇÃÇPèÑñ⁄ÇÃèÍçáÇ©ÅAÉcÉÇÇ¡ÇƒÇ´ÇΩîvà»äOÇÉJÉìÇµÇΩèÍçá
		haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+4) += "∂›X"
		HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+4) += "<td>ÉJÉì<br>ÉEÉ`</td>"
	} else {
		haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+2) += "∂›X"
		HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+2) += "<td>ÉJÉì<br>ÉEÉ`</td>"
	}
return

/* ÉJÉìÇ™ê¨å˜ÇµÇΩèÍçáÇÃîvïàèàóù */
#deffunc haifureckanproc var GameStat
	if (haifukanflag == 1) {
		// êeÇÃÇPèÑñ⁄ÇÃèÍçáÇ©ÅAÉcÉÇÇ¡ÇƒÇ´ÇΩîvà»äOÇÉJÉìÇµÇΩèÍçá
		haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+4) += "∂› "
		HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+4) += "<td>ÉJÉì</td>"
	} else {
		haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+2) += "∂› "
		haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+3) += "Å@ "
		haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+4) += "Å@ "
		HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+2) += "<td>ÉJÉì</td>"
		HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+3) += "<td></td>"
		HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+4) += "<td></td>"
	}
	// îvïàÇÃãLèqè„ÇÕÅAó‰è„îvÇÃéÊìæÇÕéüèÑÇ∆ÇµÇƒàµÇ§
	haifuskipall haifuP, HThaifuP, getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)
return

/* â‘îvÇîvïàÇ…ãLò^ */
#deffunc haifurecflower var GameStat, int DiscardTileIndex
	if ((getHeavenHandFlag(GameStat) == 1)||((DiscardTileIndex\DAHAI_TYPE_STEP) != TSUMOHAI_INDEX)) {
		// êeÇÃÇPèÑñ⁄ÇÃèÍçáÇ©ÅAÉcÉÇÇ¡ÇƒÇ´ÇΩîvà»äOÇÃèÍçá
		if (getHeavenHandFlag(GameStat) == 1) {
			haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+1) += "Å@ "
			haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+2) += "Å@ "
			HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+1) += "<td></td>"
			HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+2) += "<td></td>"
		} else {
			haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+1) += strmid(tilecodelabel, (getHand(GameStat, HAND_TILECODE, TSUMOHAI_INDEX, getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))+(getHand(GameStat, HAND_REDTILE, TSUMOHAI_INDEX, getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))*TILE_NONFLOWER_MAX))*2, 2)+" "
			haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+2) += "Å@ "
			HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+1) += "<td"+haifudoraClass(getHand(GameStat, HAND_REDTILE, TSUMOHAI_INDEX, getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)))+">"
			HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+1) += ""+strmid(HTtilecodelabel1, (getHand(GameStat, HAND_TILECODE, TSUMOHAI_INDEX, getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))+(getHand(GameStat, HAND_REDTILE, TSUMOHAI_INDEX, getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))*TILE_NONFLOWER_MAX)), 1)+"</td>"
			HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+2) += "<td></td>"
		}
		haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+3) += strmid(tilecodelabel, (getHand(GameStat, HAND_TILECODE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))+(getHand(GameStat, HAND_REDTILE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))*TILE_NONFLOWER_MAX))*2, 2)+" "
		haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+4) += "â‘ "
		HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+3) += "<td"+haifudoraClass(getHand(GameStat, HAND_REDTILE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)))+">"
		HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+3) += ""+strmid(HTtilecodelabel1, (getHand(GameStat, HAND_TILECODE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))+(getHand(GameStat, HAND_REDTILE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE))*TILE_NONFLOWER_MAX)), 1)+"</td>"
		HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+4) += "<td>â‘</td>"
	} else {
		haifuwritetsumohai haifuP, HThaifuP, getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE), getHand(GameStat, HAND_TILECODE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)), getHand(GameStat, HAND_REDTILE, (DiscardTileIndex\DAHAI_TYPE_STEP), getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)), "â‘ ", "â‘"
		haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+3) += "Å@ "
		haifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+4) += "Å@ "
		HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+3) += "<td></td>"
		HThaifuP(getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)*6+4) += "<td></td>"
	}
	// îvïàÇÃãLèqè„ÇÕÅAó‰è„îvÇÃéÊìæÇÕéüèÑÇ∆ÇµÇƒàµÇ§
	haifuskipall haifuP, HThaifuP, getCurrentPlayer(GameStat, CURRENTPLAYER_ACTIVE)
return

/* îzîvÇÉoÉbÉtÉ@Ç…èoóÕ */
#deffunc haifuwritebuffer var GameStat, var GameEnv, int OrigTurn, int OrigHonba, int tmpUraFlag, int tmpAliceFlag, str ResultDesc, int RoundEndType
	notesel haifuBuffer
	tmpstr = "ìåìÏêºñk"
	tmptxt = ""+roundName(OrigTurn)
	if (OrigHonba > 0) {tmptxt += " "+OrigHonba+"ñ{èÍ"}
	tmptxt += " ÉhÉâÅF"+haifuDora
	if ((RoundEndType == ENDKYOKU_AGARI)&&(tmpUraFlag == 1)&&(getRule(RULE_URADORA) != 1)) {tmptxt += "ó†ÉhÉâÅF"+haifuUraDora}
	if ((RoundEndType == ENDKYOKU_AGARI)&&(tmpAliceFlag == 1)&&(getRule(RULE_ALICE) != 0)) {tmptxt += "ÉAÉäÉXÅF"+haifuAliceDoraMax}
	noteadd tmptxt
	noteadd ""
	noteadd "åãâ ÅF"+ResultDesc
	noteadd ""
	notesel HThaifuBuffer
	tmptxt = ""+roundName(OrigTurn)
	if (OrigHonba > 0) {tmptxt += " "+OrigHonba+"ñ{èÍ"}
	tmptxt += " ÉhÉâÅF<span class=\"tile\">"+HThaifuDora+"</span>"
	if ((RoundEndType == ENDKYOKU_AGARI)&&(tmpUraFlag == 1)&&(getRule(RULE_URADORA) != 1)) {tmptxt += "ó†ÉhÉâÅF<span class=\"tile\">"+HThaifuUraDora+"</span>"}
	if ((RoundEndType == ENDKYOKU_AGARI)&&(tmpAliceFlag == 1)&&(getRule(RULE_ALICE) != 0)) {tmptxt += "ÉAÉäÉXÅF<span class=\"tile\">"+HThaifuAliceDoraMax+"</span>"}
	noteadd "<h2>"+tmptxt+"</h2>"
	noteadd "<p>åãâ ÅF"+ResultDesc+"</p>"
	noteadd "<table>"
	tmptxt = ""
	repeat COLUMNS
		tmptxt += "<td width="+(100.0/double(COLUMNS))+"%></td>"
	loop
	noteadd "<tr>"+tmptxt+"</tr>"
	noteunsel
	repeat NUM_OF_ACTUAL_PLAYERS
		tmpcnt = RelativePositionOf(cnt, OrigTurn\NUM_OF_PLAYERS)
#ifdef SANMAT
		if (((OrigTurn\NUM_OF_PLAYERS)+cnt) >= NUM_OF_ACTUAL_PLAYERS) {tmpcnt = (tmpcnt+1)\NUM_OF_PLAYERS}
#endif
		// ç≈èIîvép
		repeat NUM_OF_TILES_IN_HAND
			if (getHand(GameStat, HAND_TILECODE, cnt, tmpcnt) > 0) {
				if (cnt == TSUMOHAI_INDEX) {
					if ((RoundEndType == ENDKYOKU_RYUUKYOKU)||(RoundEndType == ENDKYOKU_AGARI)||(RoundEndType == ENDKYOKU_CHONBO)) {
						if (getTsumoAgariFlag(GameStat) == 1) {haifuP(tmpcnt*6+5) += " ÉcÉÇ": HThaifuP(tmpcnt*6+5) += "</span> ÉcÉÇ<span class=\"tile\">"}
						else {haifuP(tmpcnt*6+5) += " ÉçÉì": HThaifuP(tmpcnt*6+5) += "</span> ÉçÉì<span class=\"tile\">"}
					} else {
						haifuP(tmpcnt*6+5) += " "
					}
				}
				haifuP(tmpcnt*6+5) += strmid(tilecodelabel, (getHand(GameStat, HAND_TILECODE, cnt, tmpcnt)+(getHand(GameStat, HAND_REDTILE, cnt, tmpcnt)*TILE_NONFLOWER_MAX))*2, 2)
				if (getHand(GameStat, HAND_REDTILE, cnt, tmpcnt)) {HThaifuP(tmpcnt*6+5) += "<span"+haifudoraClass(getHand(GameStat, HAND_REDTILE, cnt, tmpcnt))+">"}
				HThaifuP(tmpcnt*6+5) += strmid(HTtilecodelabel1, (getHand(GameStat, HAND_TILECODE, cnt, tmpcnt)+(getHand(GameStat, HAND_REDTILE, cnt, tmpcnt)*TILE_NONFLOWER_MAX)), 1)
				if (getHand(GameStat, HAND_REDTILE, cnt, tmpcnt)) {HThaifuP(tmpcnt*6+5) += "</span>"}
			}
		loop
		if (getFlowerFlag(GameStat, tmpcnt)&FLOWER_ALL_SEASONS) {haifuP(tmpcnt*6+5) += " ": HThaifuP(tmpcnt*6+5) += "</span> <span class=\"tile\">"}
		if (getFlowerFlag(GameStat, tmpcnt)&FLOWER_SPRING) {haifuP(tmpcnt*6+5) += "èt": HThaifuP(tmpcnt*6+5) += "@"}
		if (getFlowerFlag(GameStat, tmpcnt)&FLOWER_SUMMER) {haifuP(tmpcnt*6+5) += "âƒ": HThaifuP(tmpcnt*6+5) += ";"}
		if (getFlowerFlag(GameStat, tmpcnt)&FLOWER_AUTUMN) {haifuP(tmpcnt*6+5) += "èH": HThaifuP(tmpcnt*6+5) += ":"}
		if (getFlowerFlag(GameStat, tmpcnt)&FLOWER_WINTER) {haifuP(tmpcnt*6+5) += "ì~": HThaifuP(tmpcnt*6+5) += "]"}
		if (getFlowerFlag(GameStat, tmpcnt)&FLOWER_ALL_FLOWERS) {haifuP(tmpcnt*6+5) += " ": HThaifuP(tmpcnt*6+5) += "</span> <span class=\"tile\">"}
		if (getFlowerFlag(GameStat, tmpcnt)&FLOWER_PLUM) {haifuP(tmpcnt*6+5) += "î~": HThaifuP(tmpcnt*6+5) += "-"}
		if (getFlowerFlag(GameStat, tmpcnt)&FLOWER_ORCHID) {haifuP(tmpcnt*6+5) += "óñ": HThaifuP(tmpcnt*6+5) += "^"}
		if (getFlowerFlag(GameStat, tmpcnt)&FLOWER_CHRYSANTHEMUM) {haifuP(tmpcnt*6+5) += "ãe": HThaifuP(tmpcnt*6+5) += "["}
		if (getFlowerFlag(GameStat, tmpcnt)&FLOWER_BAMBOO) {haifuP(tmpcnt*6+5) += "í|": HThaifuP(tmpcnt*6+5) += "\\"}
		repeat MeldPointer(GameStat, tmpcnt), 1
			tmpAkaDoraFlag1 = (getMeld(GameStat, MELD_REDTILE, cnt, tmpcnt)&0x01)/0x01
			tmpAkaDoraFlag2 = (getMeld(GameStat, MELD_REDTILE, cnt, tmpcnt)&0x02)/0x02
			tmpAkaDoraFlag3 = (getMeld(GameStat, MELD_REDTILE, cnt, tmpcnt)&0x04)/0x04
			tmpAkaDoraFlag4 = (getMeld(GameStat, MELD_REDTILE, cnt, tmpcnt)&0x08)/0x08
			tmpAkaDoraFlag1 += (getMeld(GameStat, MELD_REDTILE, cnt, tmpcnt)&0x10)/0x10*2
			tmpAkaDoraFlag2 += (getMeld(GameStat, MELD_REDTILE, cnt, tmpcnt)&0x20)/0x20*2
			tmpAkaDoraFlag3 += (getMeld(GameStat, MELD_REDTILE, cnt, tmpcnt)&0x40)/0x40*2
			tmpAkaDoraFlag4 += (getMeld(GameStat, MELD_REDTILE, cnt, tmpcnt)&0x80)/0x80*2
			#define HT_NakiMianzi(%1,%2,%3)  if (%2) {HThaifuP(tmpcnt*6+5) += "<span"+haifudoraClass(%2)+">"}: HThaifuP(tmpcnt*6+5) += strmid((%3), (%1)+((%2)*TILE_NONFLOWER_MAX), 1): if (%2) {HThaifuP(tmpcnt*6+5) += "</span>"}
			switch (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)/MELD_TYPE_STEP)
				/* ñæèáéq */
				case MELD_SEQUENCE_EXPOSED_LOWER:
					haifuP(tmpcnt*6+5) += " ÅÉÉ`Å["
					haifuP(tmpcnt*6+5) += "["+strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag1*TILE_NONFLOWER_MAX))*2, 2)+"]"
					haifuP(tmpcnt*6+5) += strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM+1)+(tmpAkaDoraFlag2*TILE_NONFLOWER_MAX))*2, 2)
					haifuP(tmpcnt*6+5) += strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM+2)+(tmpAkaDoraFlag3*TILE_NONFLOWER_MAX))*2, 2)
					HThaifuP(tmpcnt*6+5) += "</span> É`Å[<span class=\"tile\">"
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag1, HTtilecodelabel2
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM+1), tmpAkaDoraFlag2, HTtilecodelabel1
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM+2), tmpAkaDoraFlag3, HTtilecodelabel1
					swbreak
				case MELD_SEQUENCE_EXPOSED_MIDDLE:
					haifuP(tmpcnt*6+5) += " ÅÉÉ`Å["
					haifuP(tmpcnt*6+5) += "["+strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM+1)+(tmpAkaDoraFlag2*TILE_NONFLOWER_MAX))*2, 2)+"]"
					haifuP(tmpcnt*6+5) += strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag1*TILE_NONFLOWER_MAX))*2, 2)
					haifuP(tmpcnt*6+5) += strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM+2)+(tmpAkaDoraFlag3*TILE_NONFLOWER_MAX))*2, 2)
					HThaifuP(tmpcnt*6+5) += "</span> É`Å[<span class=\"tile\">"
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM+1), tmpAkaDoraFlag2, HTtilecodelabel2
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag1, HTtilecodelabel1
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM+2), tmpAkaDoraFlag3, HTtilecodelabel1
					swbreak
				case MELD_SEQUENCE_EXPOSED_UPPER:
					haifuP(tmpcnt*6+5) += " ÅÉÉ`Å["
					haifuP(tmpcnt*6+5) += "["+strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM+2)+(tmpAkaDoraFlag3*TILE_NONFLOWER_MAX))*2, 2)+"]"
					haifuP(tmpcnt*6+5) += strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag1*TILE_NONFLOWER_MAX))*2, 2)
					haifuP(tmpcnt*6+5) += strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM+1)+(tmpAkaDoraFlag2*TILE_NONFLOWER_MAX))*2, 2)
					HThaifuP(tmpcnt*6+5) += "</span> É`Å[<span class=\"tile\">"
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM+2), tmpAkaDoraFlag3, HTtilecodelabel2
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag1, HTtilecodelabel1
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM+1), tmpAkaDoraFlag2, HTtilecodelabel1
					swbreak
				/* ñæçèéq */
				case MELD_TRIPLET_EXPOSED_LEFT:
					haifuP(tmpcnt*6+5) += " ÅÉÉ|Éì"
					haifuP(tmpcnt*6+5) += "["+strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag1*TILE_NONFLOWER_MAX))*2, 2)+"]"
					haifuP(tmpcnt*6+5) += strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag2*TILE_NONFLOWER_MAX))*2, 2)
					haifuP(tmpcnt*6+5) += strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag3*TILE_NONFLOWER_MAX))*2, 2)
					HThaifuP(tmpcnt*6+5) += "</span> É|Éì<span class=\"tile\">"
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag1, HTtilecodelabel2
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag2, HTtilecodelabel1
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag3, HTtilecodelabel1
					swbreak
				case MELD_TRIPLET_EXPOSED_CENTER:
					haifuP(tmpcnt*6+5) += " Å»É|Éì"
					haifuP(tmpcnt*6+5) += strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag2*TILE_NONFLOWER_MAX))*2, 2)
					haifuP(tmpcnt*6+5) += "["+strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag1*TILE_NONFLOWER_MAX))*2, 2)+"]"
					haifuP(tmpcnt*6+5) += strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag3*TILE_NONFLOWER_MAX))*2, 2)
					HThaifuP(tmpcnt*6+5) += "</span> É|Éì<span class=\"tile\">"
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag2, HTtilecodelabel1
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag1, HTtilecodelabel2
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag3, HTtilecodelabel1
					swbreak
				case MELD_TRIPLET_EXPOSED_RIGHT:
					haifuP(tmpcnt*6+5) += " ÅÑÉ|Éì"
					haifuP(tmpcnt*6+5) += strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag2*TILE_NONFLOWER_MAX))*2, 2)
					haifuP(tmpcnt*6+5) += strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag3*TILE_NONFLOWER_MAX))*2, 2)
					haifuP(tmpcnt*6+5) += "["+strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag1*TILE_NONFLOWER_MAX))*2, 2)+"]"
					HThaifuP(tmpcnt*6+5) += "</span> É|Éì<span class=\"tile\">"
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag2, HTtilecodelabel1
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag3, HTtilecodelabel1
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag1, HTtilecodelabel2
					swbreak
				/* à√û»éq */
				case MELD_QUAD_CONCEALED:
					haifuP(tmpcnt*6+5) += " ÅûÉJÉì"
					haifuP(tmpcnt*6+5) += strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag1*TILE_NONFLOWER_MAX))*2, 2)
					haifuP(tmpcnt*6+5) += strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag2*TILE_NONFLOWER_MAX))*2, 2)
					haifuP(tmpcnt*6+5) += strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag3*TILE_NONFLOWER_MAX))*2, 2)
					haifuP(tmpcnt*6+5) += strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag4*TILE_NONFLOWER_MAX))*2, 2)
					HThaifuP(tmpcnt*6+5) += "</span> ÉJÉì<span class=\"tile\">"
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag1, HTtilecodelabel1
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag2, HTtilecodelabel1
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag3, HTtilecodelabel1
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag4, HTtilecodelabel1
					swbreak
				/* ëÂñæû» */
				case MELD_QUAD_EXPOSED_LEFT:
					haifuP(tmpcnt*6+5) += " ÅÉÉJÉì"
					haifuP(tmpcnt*6+5) += "["+strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag1*TILE_NONFLOWER_MAX))*2, 2)+"]"
					haifuP(tmpcnt*6+5) += strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag2*TILE_NONFLOWER_MAX))*2, 2)
					haifuP(tmpcnt*6+5) += strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag3*TILE_NONFLOWER_MAX))*2, 2)
					haifuP(tmpcnt*6+5) += strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag4*TILE_NONFLOWER_MAX))*2, 2)
					HThaifuP(tmpcnt*6+5) += "</span> ÉJÉì<span class=\"tile\">"
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag1, HTtilecodelabel2
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag2, HTtilecodelabel1
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag3, HTtilecodelabel1
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag4, HTtilecodelabel1
					swbreak
				case MELD_QUAD_EXPOSED_CENTER:
					haifuP(tmpcnt*6+5) += " Å»ÉJÉì"
					haifuP(tmpcnt*6+5) += strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag2*TILE_NONFLOWER_MAX))*2, 2)
					haifuP(tmpcnt*6+5) += "["+strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag1*TILE_NONFLOWER_MAX))*2, 2)+"]"
					haifuP(tmpcnt*6+5) += strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag3*TILE_NONFLOWER_MAX))*2, 2)
					haifuP(tmpcnt*6+5) += strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag4*TILE_NONFLOWER_MAX))*2, 2)
					HThaifuP(tmpcnt*6+5) += "</span> ÉJÉì<span class=\"tile\">"
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag2, HTtilecodelabel1
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag1, HTtilecodelabel2
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag3, HTtilecodelabel1
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag4, HTtilecodelabel1
					swbreak
				case MELD_QUAD_EXPOSED_RIGHT:
					haifuP(tmpcnt*6+5) += " ÅÑÉJÉì"
					haifuP(tmpcnt*6+5) += strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag2*TILE_NONFLOWER_MAX))*2, 2)
					haifuP(tmpcnt*6+5) += strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag3*TILE_NONFLOWER_MAX))*2, 2)
					haifuP(tmpcnt*6+5) += strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag4*TILE_NONFLOWER_MAX))*2, 2)
					haifuP(tmpcnt*6+5) += "["+strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag1*TILE_NONFLOWER_MAX))*2, 2)+"]"
					HThaifuP(tmpcnt*6+5) += "</span> ÉJÉì<span class=\"tile\">"
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag2, HTtilecodelabel1
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag3, HTtilecodelabel1
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag4, HTtilecodelabel1
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag1, HTtilecodelabel2
					swbreak
				/* â¡û» */
				case MELD_QUAD_ADDED_LEFT:
					haifuP(tmpcnt*6+5) += " ÅÉÅ§ÉJÉì"
					haifuP(tmpcnt*6+5) += "["+strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag4*TILE_NONFLOWER_MAX))*2, 2)
					haifuP(tmpcnt*6+5) += strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag1*TILE_NONFLOWER_MAX))*2, 2)+"]"
					haifuP(tmpcnt*6+5) += strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag2*TILE_NONFLOWER_MAX))*2, 2)
					haifuP(tmpcnt*6+5) += strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag3*TILE_NONFLOWER_MAX))*2, 2)
					HThaifuP(tmpcnt*6+5) += "</span> ÉJÉì<span class=\"tile\">"
					HThaifuP(tmpcnt*6+5) += "<table class=\"kakan\"><tr><td>"
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag4, HTtilecodelabel2
					HThaifuP(tmpcnt*6+5) += "<br>"
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag1, HTtilecodelabel2
					HThaifuP(tmpcnt*6+5) += "</tr></td></table>"
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag2, HTtilecodelabel1
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag3, HTtilecodelabel1
					swbreak
				case MELD_QUAD_ADDED_CENTER:
					haifuP(tmpcnt*6+5) += " Å»Å§ÉJÉì"
					haifuP(tmpcnt*6+5) += strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag2*TILE_NONFLOWER_MAX))*2, 2)
					haifuP(tmpcnt*6+5) += "["+strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag4*TILE_NONFLOWER_MAX))*2, 2)
					haifuP(tmpcnt*6+5) += strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag1*TILE_NONFLOWER_MAX))*2, 2)+"]"
					haifuP(tmpcnt*6+5) += strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag3*TILE_NONFLOWER_MAX))*2, 2)
					HThaifuP(tmpcnt*6+5) += "</span> ÉJÉì<span class=\"tile\">"
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag2, HTtilecodelabel1
					HThaifuP(tmpcnt*6+5) += "<table class=\"kakan\"><tr><td>"
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag4, HTtilecodelabel2
					HThaifuP(tmpcnt*6+5) += "<br>"
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag1, HTtilecodelabel2
					HThaifuP(tmpcnt*6+5) += "</tr></td></table>"
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag3, HTtilecodelabel1
					swbreak
				case MELD_QUAD_ADDED_RIGHT:
					haifuP(tmpcnt*6+5) += " ÅÑÅ§ÉJÉì"
					haifuP(tmpcnt*6+5) += strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag2*TILE_NONFLOWER_MAX))*2, 2)
					haifuP(tmpcnt*6+5) += strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag3*TILE_NONFLOWER_MAX))*2, 2)
					haifuP(tmpcnt*6+5) += "["+strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag4*TILE_NONFLOWER_MAX))*2, 2)
					haifuP(tmpcnt*6+5) += strmid(tilecodelabel, ((getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM)+(tmpAkaDoraFlag1*TILE_NONFLOWER_MAX))*2, 2)+"]"
					HThaifuP(tmpcnt*6+5) += "</span> ÉJÉì<span class=\"tile\">"
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag2, HTtilecodelabel1
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag3, HTtilecodelabel1
					HThaifuP(tmpcnt*6+5) += "<table class=\"kakan\"><tr><td>"
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag4, HTtilecodelabel2
					HThaifuP(tmpcnt*6+5) += "<br>"
					HT_NakiMianzi (getMeld(GameStat, MELD_TILECODE, cnt, tmpcnt)\TILE_CODE_MAXIMUM), tmpAkaDoraFlag1, HTtilecodelabel2
					HThaifuP(tmpcnt*6+5) += "</tr></td></table>"
					swbreak
			swend
		loop
		// ì_ñ_èÛãµ
		haifutmpscore = ""
			tmpscoretxt = bignumtotext(origPoint, tmpcnt, 100, "", "Å¢")
			haifutmpscore += tmpscoretxt
			
		if (origPoint(tmpcnt) != getScore(GameStat,tmpcnt)) {
			haifutmpscore += " Å® "
			exportScore GameStat, scoreArray
			tmpscoretxt = bignumtotext(scoreArray, tmpcnt, 100, "", "Å¢")
			if (tmpscoretxt == "") {tmpscoretxt += "0"}
			haifutmpscore += tmpscoretxt

			dim diffPoint, NUM_OF_DIGIT_GROUPS
			repeat NUM_OF_DIGIT_GROUPS
				diffPoint(cnt) = getScore(GameStat,tmpcnt, cnt)-origPoint(tmpcnt, cnt)
			loop
			diffflagfix diffPoint

			tmpscoretxt = bignumtotext(diffPoint, 0, 100, "+", "-")

			haifutmpscore += " ("+(tmpscoretxt)+")"
		}
		if (getRule(RULE_CHIP) != 0) {
			if (getChip(GameStat, tmpcnt) >= 0) {haifutmpscore += " É`ÉbÉv: +"+getChip(GameStat, tmpcnt)}
			else {haifutmpscore += " É`ÉbÉv: "+getChip(GameStat, tmpcnt)}
		}
		chatappend "*** "+getPlayerName(GameEnv, tmpcnt)+"("+windName(cnt)+") "+haifutmpscore+"\n"

		noteadd windName(cnt)+" "+getPlayerName(GameEnv, tmpcnt)+" "+haifutmpscore
		notesel HThaifuBuffer
		noteadd "<tr><td colspan="+COLUMNS+" class=\"player\">"+windName(cnt)+" "+getPlayerName(GameEnv, tmpcnt)+" "+haifutmpscore+"</td></tr>"
		noteunsel
#ifdef SANMA4
		if (cnt < 3) {
#endif
			noteadd "îzîvÅF"+haifuP(tmpcnt*6)
			notesel HThaifuBuffer
			noteadd "<tr><td class=\"label\">îzîv</td><td colspan="+(COLUMNS-1)+"><span class=\"tile\">"+HThaifuP(tmpcnt*6)+"</span></td></tr>"
			noteunsel
#ifdef SANMA4
		}
#endif
		noteadd ""
#ifdef SANMA4
		if (cnt < 3) {
#endif
			if (getHeavenHandFlag(GameStat) == 0) {
				// ìVòa(Ç‹ÇΩÇÕêeÇÃè\éOïsìÉÇ‚ã„éÌã„îv)ÇÃèÍçáÇÕè»ó™
				noteadd "é©ñÃÅF"+haifuP(tmpcnt*6+1)
				noteadd "Å@Å@Å@"+haifuP(tmpcnt*6+2)
				noteadd "ë≈îvÅF"+haifuP(tmpcnt*6+3)
				noteadd "Å@Å@Å@"+haifuP(tmpcnt*6+4)
				noteadd "îvépÅF"+haifuP(tmpcnt*6+5)
				noteadd ""
				notesel HThaifuBuffer
				noteadd "<tr class=\"tile\"><td class=\"label\" rowspan=2>é©ñÃ</td>"+HThaifuP(tmpcnt*6+1)+"</tr>"
				noteadd "<tr class=\"notice\">"+HThaifuP(tmpcnt*6+2)+"</tr>"
				noteadd "<tr class=\"tile\"><td class=\"label\" rowspan=2>ë≈îv</td>"+HThaifuP(tmpcnt*6+3)+"</tr>"
				noteadd "<tr class=\"notice\">"+HThaifuP(tmpcnt*6+4)+"</tr>"
				noteadd "<tr><td class=\"label\">îvép</td><td colspan="+(COLUMNS-1)+" class=\"hand\"><span class=\"tile\">"+HThaifuP(tmpcnt*6+5)+"</span></td></tr>"
				noteunsel
			}
#ifdef SANMA4
		}
#endif
	loop
	noteadd "------------------------------------------------------------------------------"
	noteadd ""
	noteunsel
	notesel HThaifuBuffer
	noteadd "</table>"
	noteadd "<hr>"
	noteunsel
return

/* îzîvÇï€ë∂ */
#deffunc haifusave
	configPath = confPath()
	if (configPath != "") {configPath += "\\"}
	notesel HThaifuBuffer
	noteadd "</body>"
	noteadd "</html>"
	noteunsel
	notesel haifuBuffer
#ifdef SANMAS
	tmpfilename1 = configPath+"haifu\\mihassnm_"+VERSION_MAJ+"_"+VERSION_MED+"_"+VERSION_MIN+""+VERSION_MIC
#else
	#ifdef SANMA4
		tmpfilename1 = configPath+"haifu\\mihaysnm_"+VERSION_MAJ+"_"+VERSION_MED+"_"+VERSION_MIN+""+VERSION_MIC
	#else
		#ifdef SANMA
			tmpfilename1 = configPath+"haifu\\mihasanm_"+VERSION_MAJ+"_"+VERSION_MED+"_"+VERSION_MIN+""+VERSION_MIC
		#else
			tmpfilename1 = configPath+"haifu\\mihajong_"+VERSION_MAJ+"_"+VERSION_MED+"_"+VERSION_MIN+""+VERSION_MIC
		#endif
	#endif
#endif
	tmpfilename2 = strf("%04d%02d%02d_%02d%02d", gettime(0), gettime(1), gettime(3), gettime(4), gettime(5))
	notesave tmpfilename1+"_haifu_"+tmpfilename2+".txt"
	noteunsel
	notesel ChatLog
	notesave tmpfilename1+"_chatlog_"+tmpfilename2+".txt"
	noteunsel
	notesel HThaifuBuffer
	notesave tmpfilename1+"_haifu_"+tmpfilename2+".htm"
	noteunsel
return

#global
